pipeline {
    agent any
    environment {
        PATH = "$PATH:/usr/local/bin/"
    }
    stages {
        stage('CloneGit') {
            steps {
                sh "mkdir -p Kubernetes"
                dir('/var/lib/jenkins/workspace/Pipeline-EKS/Kubernetes'){
                    git credentialsId: 'oli', url: 'git@github.com:aylinaroche/Kubernetes-Files.git'
                }
                echo 'SUCCESSFUL CLONE GIT..'
            }
        }
        stage('Cluster') {
            steps {
                dir('/var/lib/jenkins/workspace/Pipeline-EKS/Kubernetes/EKS/Flask'){
                    sh """
                        export AWS_ACCESS_KEY_ID="ASIAXFHK42N5JJWJUAV4"
                        export AWS_SECRET_ACCESS_KEY="tbdkCzixmhYzANYIVN22SNLiCFbWf5rgkgrunJgX"
                        export AWS_SESSION_TOKEN="IQoJb3JpZ2luX2VjEEEaCXVzLXdlc3QtMiJHMEUCIC1O6Dy0jimTPAhirHiXeSDWF+Vn14JskEzF/OVjeKlNAiEAsElFNCHulw2KRrhIE5LT7eiR5HVO7yPui9Cj0jWdNooqigIIShABGgw0OTIyNjYzNzgxMDYiDEwH/JvsAoGLLOJ9airnAQ2pxdVtJrmRx7d1C9HZdqIkeoOMtwhcDZ5tZZ8zOQk+pWEl/zRkcPjfK/uadbdU3rj8GD2Fe1Yz8F9T3xDLHYFHXwFpNoV/UD4O2mEIQa/P3xgxCcmHLdv4mlD8T16Vo/BGlk76IYdqb25d4Mds8gQaAL2czvGPvnoQYJinWPEVcVuDdjfpysEL8rRi+t4LJCUTtYy7lKGR1pXcOUJOanjc9unO6D9js2cWxKdz/e6s3sIvIy21P2JskabI7G3ZOTnYxDL2mYeNZwk1VgE0cqAO8UcfJegoJJmtzzNOCKMI3BxPQrX0DzC6w8ztBTrpAQDlSI5CvMmiu/NcwpTs9aL5ItPrLzZW1hOqIOzZByVCegOd7cW6/NCY/ZgeE1CSSKxFLTOwCMI6NsGg0X2W15KLAicaJ7B0hvN4eH3Tt8jhLA0etcpUfQkXvUWybCeMGb9C8zpMA7VMjqr0Msi59lFaUj8Bi8XlZzzzaY9Y4IfXCix9prCG3Nt0gBX1LJeAXNzrJpMDYr0CrTuMqKsmys+s1jAD584hpLofuwJ5aAPRPFGu+lbu1IhdcJh7FY9cDrjrVimYEN2FjiJRA1UJUERXKhc7WIIwFKUHsiLVzcmH7SbyrpswcFXM"
                        export AWS_DEFAULT_REGION=us-west-2                         
                        aws eks update-kubeconfig --name Cluster1-Aylin
                        eksctl version
                        kubectl version
                        kubectl delete -f client-deployment.yaml 
                        kubectl apply -f client-deployment.yaml
                        kubectl delete -f client-node-port.yaml 
                        kubectl apply -f client-node-port.yaml 
                        kubectl get all
                    """
                        /*
                        
                        eksctl update cluster \
                            --name Cluster1-Aylin \
                            --version 1.14 \
                            --nodegroup-name worker1-aylin \
                            --node-type t2.micro \
                            --nodes 3 \
                            --nodes-min 1 \
                            --nodes-max 4 \
                            --node-ami auto
                            */
                    echo 'SUCCESSFUL UPLOAD..'
                }
            }
        }
    }
}